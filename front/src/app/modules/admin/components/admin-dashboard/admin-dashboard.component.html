<div class="container-fluid py-5" *ngIf="kpis$ | async as kpi">
    <div class="header-section mb-5">
        <h1 class="display-5 fw-bold text-gradient brand-font">SportStore - Administration</h1>
    </div>

    <!-- KPI Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card premium-card h-100 border-start border-4 border-primary">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-primary-soft me-3">üí∞</div>
                        <h6 class="card-subtitle text-muted mb-0">Revenu Total</h6>
                    </div>
                    <h2 class="display-6 fw-bold mb-0 text-primary">{{ kpi.totalRevenue | currency:'USD' }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card premium-card h-100 border-start border-4 border-success">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-success-soft me-3">üõí</div>
                        <h6 class="card-subtitle text-muted mb-0">Commandes</h6>
                    </div>
                    <h2 class="display-6 fw-bold mb-0 text-success">{{ kpi.totalOrders }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card premium-card h-100 border-start border-4 border-info">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-info-soft me-3">üì¶</div>
                        <h6 class="card-subtitle text-muted mb-0">Produits</h6>
                    </div>
                    <h2 class="display-6 fw-bold mb-0 text-info">{{ kpi.totalProducts }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card premium-card h-100 border-start border-4 border-warning">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-warning-soft me-3">üìÅ</div>
                        <h6 class="card-subtitle text-muted mb-0">Cat√©gories</h6>
                    </div>
                    <h2 class="display-6 fw-bold mb-0 text-warning">{{ kpi.totalCategories }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Section: Category Sales & DWH -->
    <div class="row g-4 mb-5">
        <div class="col-lg-12">
            <div class="card premium-card glass-effect border-0 h-100">
                <div class="card-header bg-transparent border-0 p-4">
                    <h5 class="fw-bold mb-0 brand-font">üìä R√©partition par Cat√©gorie</h5>
                    <small class="text-muted">Ventes cumul√©es par cat√©gorie (CRUD)</small>
                </div>
                <div class="card-body p-4 d-flex align-items-center justify-content-center">
                    <div style="max-height: 400px; width: 100%;">
                        <canvas baseChart [data]="pieChartData" [type]="'pie'">
                        </canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DWH Section (Restored & Fixed) -->
    <div class="row g-4 mb-4 mt-5">
        <div class="col-12">
            <h5 class="fw-bold text-muted mb-2 brand-font">
                <span class="badge bg-secondary me-2">DWH</span>
                Analyses depuis Exam_DWH (V√©rifi√© & Op√©rationnel)
            </h5>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <!-- DWH: Person Type -->
        <div class="col-lg-5">
            <div class="card premium-card glass-effect border-0 h-100">
                <div class="card-header bg-transparent border-0 p-4">
                    <h5 class="fw-bold mb-0 brand-font">R√©partition des Personnes (DWH)</h5>
                    <small class="text-muted">Analyse d√©mographique (DWH)</small>
                </div>
                <div class="card-body p-4 d-flex align-items-center justify-content-center">
                    <canvas baseChart [data]="personTypeChartData" [type]="'bar'"></canvas>
                </div>
            </div>
        </div>
        <!-- DWH: Top Products -->
        <div class="col-lg-7">
            <div class="card premium-card glass-effect border-0 h-100">
                <div class="card-header bg-transparent border-0 p-4">
                    <h5 class="fw-bold mb-0 brand-font">üèÜ Top 10 Produits par Revenu (DWH)</h5>
                    <small class="text-muted">Performance des ventes historiques (DWH)</small>
                </div>
                <div class="card-body p-4">
                    <canvas baseChart [data]="topProductsChartData" [type]="'bar'"
                        [options]="{ indexAxis: 'y', plugins: { legend: { display: false } } }"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <!-- DWH: Territory -->
        <div class="col-lg-12">
            <div class="card premium-card glass-effect border-0 h-100">
                <div class="card-header bg-transparent border-0 p-4">
                    <h5 class="fw-bold mb-0 brand-font">üåç Ventes par Territoire (DWH)</h5>
                    <small class="text-muted">R√©partition g√©ographique (DWH)</small>
                </div>
                <div class="card-body p-4">
                    <canvas baseChart [data]="territoryChartData" [type]="'bar'"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4">
        <div class="col-lg-12">
            <div class="card premium-card glass-effect border-0">
                <div class="card-header bg-transparent border-0 p-4 pb-0">
                    <h5 class="fw-bold mb-0 brand-font">Actions Rapides d'Administration</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        <div class="col-sm-3">
                            <a routerLink="/admin/articles"
                                class="btn btn-premium btn-primary w-100 p-3 d-flex align-items-center justify-content-center gap-2">
                                <mat-icon>inventory_2</mat-icon> Produits
                            </a>
                        </div>
                        <div class="col-sm-3">
                            <a routerLink="/admin/users"
                                class="btn btn-premium btn-warning w-100 p-3 d-flex align-items-center justify-content-center gap-2">
                                <mat-icon>people</mat-icon> Utilisateurs
                            </a>
                        </div>
                        <div class="col-sm-3">
                            <a routerLink="/admin/categories"
                                class="btn btn-premium btn-success w-100 p-3 d-flex align-items-center justify-content-center gap-2">
                                <mat-icon>category</mat-icon> Cat√©gories
                            </a>
                        </div>
                        <div class="col-sm-3">
                            <a routerLink="/admin/subcategories"
                                class="btn btn-premium btn-info w-100 p-3 d-flex align-items-center justify-content-center gap-2">
                                <mat-icon>account_tree</mat-icon> Sous-cat√©gories
                            </a>
                        </div>
                        <div class="col-sm-3">
                            <button
                                class="btn btn-outline-primary w-100 p-3 d-flex align-items-center justify-content-center gap-2"
                                (click)="ngOnInit()">
                                <mat-icon>refresh</mat-icon> Actualiser
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>